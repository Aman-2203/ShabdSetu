<html lang="en" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShabdSetu - AI-Powered OCR &amp; Translation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;family=DM+Sans:wght@400;500;600;700&amp;display=swap"
        rel="stylesheet">

    <style>
        :root {
            --primary: #ffffff;
            --primary-light: #e5e5e5;
            --secondary: #1a1a1a;
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-purple: #a78bfa;
            --accent-amber: #fbbf24;
            --accent-red: #f87171;
            --success: #10b981;
            --warning: #fbbf24;
            --error: #f87171;
            --gray: #a1a1aa;
            --gray-light: #71717a;
            --light: #ffffff;
            --border: #27272a;
            --background: #0a0a0a;
            --card-bg: #18181b;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4), 0 2px 6px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.5), 0 10px 20px rgba(0, 0, 0, 0.4);
            --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
            --ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        [data-theme="light"] {
            --primary: #000000;
            --primary-light: #1a1a1a;
            --secondary: #ffffff;
            --accent-blue: #2563eb;
            --accent-green: #10b981;
            --accent-purple: #8b5cf6;
            --accent-amber: #f59e0b;
            --accent-red: #ef4444;
            --gray: #666666;
            --gray-light: #999999;
            --light: #ffffff;
            --border: #e5e5e5;
            --background: #fafafa;
            --card-bg: #ffffff;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.06), 0 2px 6px rgba(0, 0, 0, 0.03);
            --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.08), 0 10px 20px rgba(0, 0, 0, 0.04);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            min-height: 100vh;
            padding: 1rem;
            padding-top: 6rem;
            color: var(--primary);
            letter-spacing: -0.01em;
            line-height: 1.6;
            transition: background 0.3s var(--ease-smooth), color 0.3s var(--ease-smooth);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border);
            transition: all 0.3s var(--ease-smooth);
        }

        [data-theme="light"] .header {
            background: rgba(250, 250, 250, 0.95);
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            color: var(--primary);
            font-family: 'DM Sans', sans-serif;
            font-size: 1.125rem;
            font-weight: 700;
            z-index: 101;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .logo-icon svg {
            width: 20px;
            height: 20px;
            color: white;
        }

        .nav-menu {
            display: flex;
            align-items: center;
            gap: 2rem;
            list-style: none;
        }

        .nav-link {
            color: var(--gray);
            text-decoration: none;
            font-size: 0.9375rem;
            font-weight: 500;
            transition: color 0.2s ease;
            white-space: nowrap;
        }

        .nav-link:hover {
            color: var(--primary);
        }

        .mobile-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            padding: 0.5rem;
            z-index: 101;
        }

        .mobile-toggle svg {
            width: 24px;
            height: 24px;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            margin-top: 10px;
            top: 1rem;
            right: 1rem;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--card-bg);
            border: 2px solid var(--border);
            color: var(--primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-md);
            transition: all 0.3s var(--ease-smooth);
            z-index: 101;
            margin-bottom: 40px;
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent-blue);
        }

        .theme-toggle svg {
            width: 20px;
            height: 20px;
            transition: all 0.3s var(--ease-smooth);
        }

        .theme-toggle .sun-icon {
            display: none;
        }

        [data-theme="light"] .theme-toggle .moon-icon {
            display: none;
        }

        [data-theme="light"] .theme-toggle .sun-icon {
            display: block;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInDown 0.8s var(--ease-smooth);
        }

        .hero h1 {
            font-family: 'DM Sans', 'Inter', sans-serif;
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 700;
            margin-bottom: 1rem;
            letter-spacing: -0.04em;
            color: var(--primary);
            line-height: 1.1;
        }

        .hero h1::after {
            content: '';
            display: block;
            width: 80px;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            border-radius: 2px;
            margin: 1rem auto 0;
        }

        .hero p {
            font-size: clamp(1rem, 2vw, 1.125rem);
            color: var(--gray);
            font-weight: 400;
            letter-spacing: -0.01em;
        }

        /* Mode Selection Grid */
        .modes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.25rem;
            margin-bottom: 2rem;
        }

        .mode-card {
            background: var(--card-bg);
            backdrop-filter: blur(8px);
            border-radius: 20px;
            padding: 2rem;
            cursor: pointer;
            transition: all 0.4s var(--ease-smooth);
            box-shadow: var(--shadow-sm);
            border: 2px solid var(--border);
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.6s var(--ease-smooth) backwards;
        }

        .mode-card:nth-child(1) {
            animation-delay: 0.1s;
        }

        .mode-card:nth-child(2) {
            animation-delay: 0.2s;
        }

        .mode-card:nth-child(3) {
            animation-delay: 0.3s;
        }

        .mode-card:nth-child(4) {
            animation-delay: 0.4s;
        }

        .mode-card:nth-child(5) {
            animation-delay: 0.5s;
        }

        .mode-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.4s ease;
            border-radius: 20px;
            z-index: 0;
        }

        .mode-card[data-mode="1"]::before,
        .mode-card[data-mode="4"]::before {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, transparent 100%);
        }

        .mode-card[data-mode="2"]::before,
        .mode-card[data-mode="3"]::before {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, transparent 100%);
        }

        .mode-card[data-mode="5"]::before {
            background: linear-gradient(135deg, rgba(167, 139, 250, 0.1) 0%, transparent 100%);
        }

        .mode-card>* {
            position: relative;
            z-index: 1;
        }

        .mode-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(59, 130, 246, 0.15);
            border-color: var(--accent-blue);
        }

        .mode-card:hover::before {
            opacity: 1;
        }

        .mode-card.active {
            border-color: var(--accent-blue);
            background: linear-gradient(135deg, var(--accent-blue), #1e40af);
            box-shadow: 0 20px 40px rgba(59, 130, 246, 0.25);
            transform: translateY(-4px);
        }

        .mode-card[data-mode="2"].active,
        .mode-card[data-mode="3"].active {
            background: linear-gradient(135deg, var(--accent-green), #059669);
        }

        .mode-card[data-mode="5"].active {
            background: linear-gradient(135deg, var(--accent-purple), #7c3aed);
        }

        .mode-card.active .mode-icon {
            background: var(--light);
        }

        .mode-card.active .mode-icon svg {
            color: var(--accent-blue);
        }

        .mode-card[data-mode="2"].active .mode-icon svg,
        .mode-card[data-mode="3"].active .mode-icon svg {
            color: var(--accent-green);
        }

        .mode-card[data-mode="5"].active .mode-icon svg {
            color: var(--accent-purple);
        }

        .mode-card.active h3,
        .mode-card.active p {
            color: var(--light);
        }

        .mode-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            background: var(--accent-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.25rem;
            transition: all 0.4s ease;
        }

        .mode-card[data-mode="2"] .mode-icon,
        .mode-card[data-mode="3"] .mode-icon {
            background: var(--accent-green);
        }

        .mode-card[data-mode="5"] .mode-icon {
            background: var(--accent-purple);
        }

        .mode-icon svg {
            width: 28px;
            height: 28px;
            color: var(--light);
        }

        .mode-card h3 {
            font-family: 'DM Sans', 'Inter', sans-serif;
            font-size: clamp(1.125rem, 2vw, 1.375rem);
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
            letter-spacing: -0.02em;
            transition: color 0.4s ease;
        }

        .mode-card p {
            color: var(--gray);
            font-size: clamp(0.875rem, 1.5vw, 0.9375rem);
            line-height: 1.5;
            font-weight: 400;
            transition: color 0.4s ease;
        }

        /* Processing Panel */
        .processing-panel {
            background: var(--card-bg);
            backdrop-filter: blur(8px);
            border-radius: 20px;
            padding: clamp(1.5rem, 4vw, 3rem);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border);
            display: none;
            animation: fadeInUp 0.6s var(--ease-smooth);
            width: 100%;
        }

        .processing-panel.active {
            display: block;
        }

        .processing-panel h2 {
            font-family: 'DM Sans', 'Inter', sans-serif;
            font-size: clamp(1.5rem, 3vw, 1.875rem);
            font-weight: 600;
            margin-bottom: 2rem;
            color: var(--primary);
            letter-spacing: -0.03em;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.625rem;
            color: var(--primary);
            font-size: 0.9375rem;
            letter-spacing: -0.01em;
        }

        .form-control {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s var(--ease-smooth);
            background: var(--background);
            color: var(--primary);
            font-family: 'Inter', sans-serif;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        /* File Upload */
        .file-upload {
            border: 2px dashed var(--border);
            border-radius: 16px;
            padding: 2rem 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s var(--ease-smooth);
            background: var(--background);
            position: relative;
            overflow: hidden;
        }

        .file-upload:hover {
            border-color: var(--accent-blue);
            background: var(--card-bg);
        }

        .file-upload.has-file {
            border-color: var(--accent-blue);
            background: var(--card-bg);
            border-style: solid;
        }

        .file-upload-icon {
            display: inline-flex;
            margin-bottom: 1rem;
            opacity: 0.4;
        }

        .file-upload-icon svg {
            width: 40px;
            height: 40px;
        }

        .file-upload h3 {
            font-weight: 600;
            font-size: clamp(1rem, 2vw, 1.125rem);
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .file-upload p {
            color: var(--gray);
            font-size: clamp(0.875rem, 1.5vw, 0.9375rem);
        }

        .file-upload input[type="file"] {
            display: none;
        }

        /* File Preview */
        .file-preview {
            display: none;
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: var(--background);
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .file-preview.active {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            animation: fadeInUp 0.5s ease;
        }

        .file-thumbnail {
            width: 100%;
            max-width: 120px;
            height: 140px;
            background: var(--card-bg);
            border-radius: 8px;
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            margin: 0 auto;
        }

        .file-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .file-thumbnail-icon svg {
            width: 40px;
            height: 40px;
            color: var(--gray-light);
        }

        .file-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .file-name {
            font-weight: 600;
            font-size: clamp(1rem, 2vw, 1.125rem);
            color: var(--primary);
            word-break: break-word;
            text-align: center;
        }

        .file-info {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
        }

        .file-info-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--gray);
            font-size: 0.875rem;
        }

        .file-info-item svg {
            width: 16px;
            height: 16px;
            color: var(--gray-light);
        }

        .file-remove {
            align-self: center;
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            padding: 0.625rem 1rem;
            border-radius: 8px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            margin-top: 0.5rem;
        }

        .file-remove:hover {
            background: var(--border);
            color: var(--error);
        }

        .file-remove svg {
            width: 18px;
            height: 18px;
        }

        /* Progress Bar */
        .progress-container {
            display: none;
            margin-top: 2rem;
            padding: 2rem 1.5rem;
            background: var(--background);
            border-radius: 16px;
            border: 1px solid var(--border);
        }

        .progress-container.active {
            display: block;
            animation: fadeInUp 0.5s ease;
        }

        .progress-container h3 {
            font-family: 'DM Sans', 'Inter', sans-serif;
            font-size: clamp(1rem, 2vw, 1.125rem);
            font-weight: 600;
            margin-bottom: 1.25rem;
            color: var(--primary);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            transition: width 0.3s var(--ease-smooth);
            border-radius: 4px;
        }

        .progress-fill.success {
            background: linear-gradient(90deg, var(--accent-green), #059669);
        }

        .progress-text {
            text-align: center;
            font-weight: 500;
            color: var(--gray);
            margin-top: 0.625rem;
            font-size: 0.9375rem;
        }

        /* Buttons */
        .btn {
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s var(--ease-smooth);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
            font-family: 'Inter', sans-serif;
            width: 100%;
        }

        .btn svg {
            width: 20px;
            height: 20px;
        }

        .btn-primary {
            background: var(--accent-blue);
            color: var(--light);
            box-shadow: var(--shadow-sm);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-success {
            background: var(--accent-green);
            color: var(--light);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        }

        .btn-secondary {
            background: var(--card-bg);
            color: var(--primary);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--background);
            border-color: var(--primary);
        }

        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 2rem;
        }

        /* Success Message */
        .success-message {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), transparent);
            border: 2px solid var(--accent-green);
            border-radius: 16px;
            padding: 1.5rem;
            margin-top: 2rem;
            display: none;
        }

        .success-message.active {
            display: block;
            animation: fadeInUp 0.5s var(--ease-smooth);
        }

        .success-message h4 {
            color: var(--accent-green);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: clamp(1rem, 2vw, 1.25rem);
            font-weight: 600;
        }

        .success-message h4 svg {
            width: 24px;
            height: 24px;
        }

        .success-message p {
            color: var(--gray);
            margin-bottom: 1.5rem;
            font-size: 0.9375rem;
        }

        .success-message>div {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* Footer */
        .footer {
            background: var(--card-bg);
            border-top: 1px solid var(--border);
            padding: 2rem 1rem 1rem;
            margin-top: 2rem;
            margin-bottom: -100px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h4 {
            font-family: 'DM Sans', sans-serif;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section ul li {
            margin-bottom: 0.5rem;
        }

        .footer-section ul li a {
            color: var(--gray);
            text-decoration: none;
            font-size: 0.8125rem;
            transition: color 0.2s ease;
        }

        .footer-section ul li a:hover {
            color: var(--accent-blue);
        }

        .footer-bottom {
            padding-top: 1rem;
            margin-top: 200px;
            margin-left: -200px;
            margin-bottom: -50px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .footer-bottom p {
            color: var(--gray);
            font-size: 0.8125rem;
        }

        /* Animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Tablet Responsive */
        @media (min-width: 768px) {
            body {
                padding: 2rem;
                padding-top: 7rem;
            }

            .btn-group {
                flex-direction: row;
            }

            .btn {
                width: auto;
            }

            .file-preview.active {
                flex-direction: row;
                gap: 1.5rem;
            }

            .file-thumbnail {
                margin: 0;
            }

            .file-name {
                text-align: left;
            }

            .file-info {
                justify-content: flex-start;
            }

            .file-remove {
                align-self: flex-start;
            }

            .success-message>div {
                flex-direction: row;
            }
        }

        /* Desktop Responsive */
        @media (min-width: 1024px) {
            body {
                padding: 3rem 2rem;
                padding-top: 8rem;
            }

            .modes-grid {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 1.5rem;
            }

            .nav-menu {
                display: flex;
            }
        }

        /* Mobile Menu */
        @media (max-width: 1023px) {
            .nav-menu {
                position: fixed;
                top: 70px;
                left: 0;
                right: 0;
                background: var(--card-bg);
                border-bottom: 1px solid var(--border);
                flex-direction: column;
                gap: 0;
                padding: 1rem;
                display: none;
                box-shadow: var(--shadow-lg);
            }

            .nav-menu.active {
                display: flex;
            }

            .nav-link {
                padding: 0.75rem;
                width: 100%;
                text-align: left;
            }

            .mobile-toggle {
                display: block;
            }

            .theme-toggle {
                top: 0.75rem;
                right: 4rem;
                width: 44px;
                height: 44px;
            }
        }

        /* Small Mobile */
        @media (max-width: 480px) {
            .hero h1 {
                font-size: 1.75rem;
            }

            .modes-grid {
                grid-template-columns: 1fr;
            }

            .mode-card {
                padding: 1.5rem;
            }

            .processing-panel {
                padding: 1.5rem;
            }

            .theme-toggle {
                width: 40px;
                height: 40px;
                right: 3.5rem;
            }

            .theme-toggle svg {
                width: 18px;
                height: 18px;
            }
        }

        /* Trial Status Banner */
        .trial-status-banner {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: none;
            animation: fadeInDown 0.5s var(--ease-smooth);
        }

        .trial-status-banner.active {
            display: block;
        }

        .trial-status-banner.warning {
            background: linear-gradient(135deg, var(--accent-amber), #f59e0b);
        }

        .trial-status-banner.exhausted {
            background: linear-gradient(135deg, var(--accent-red), #dc2626);
        }

        .trial-status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .trial-status-title {
            font-family: 'DM Sans', sans-serif;
            font-size: 1.125rem;
            font-weight: 600;
            color: white;
        }

        .trial-status-value {
            font-size: 0.9375rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }

        .trial-progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .trial-progress-fill {
            height: 100%;
            background: white;
            transition: width 0.3s var(--ease-smooth);
            border-radius: 4px;
        }

        .trial-status-info {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.875rem;
            margin-top: 0.75rem;
        }

        /* Error Modal */
        .error-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .error-modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .error-modal-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            box-shadow: var(--shadow-lg);
            border: 2px solid var(--accent-red);
            animation: scaleIn 0.3s var(--ease-bounce);
        }

        .error-modal-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .error-modal-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--accent-red);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .error-modal-icon svg {
            width: 24px;
            height: 24px;
            color: white;
        }

        .error-modal-title {
            font-family: 'DM Sans', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }

        .error-modal-message {
            color: var(--gray);
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        .error-modal-details {
            background: var(--background);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border);
        }

        .error-modal-detail-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            font-size: 0.9375rem;
        }

        .error-modal-detail-label {
            color: var(--gray);
        }

        .error-modal-detail-value {
            color: var(--primary);
            font-weight: 600;
        }

        .error-modal-actions {
            display: flex;
            gap: 1rem;
        }

        .error-modal-actions .btn {
            flex: 1;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="header-container">
            <a href="/" class="logo">
                <div class="logo-icon">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                        </path>
                    </svg>
                </div>
                <span>ShabdSetu</span>
            </a>

            <nav>
                <ul class="nav-menu" id="navMenu">
                    <li><a href="features" class="nav-link">Features</a></li>
                    <li><a href="pricing" class="nav-link">Pricing</a></li>
                    <li><a href="tool" class="nav-link">Tool</a></li>
                    <li><a href="contactus" class="nav-link">Contact us</a></li>
                </ul>
            </nav>

            <button class="mobile-toggle" id="mobileToggle" aria-label="Toggle menu">
                <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
        </div>
    </header>

    <button class="theme-toggle" id="themeToggle" title="Toggle Theme">
        <svg class="moon-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
        </svg>
        <svg class="sun-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
            </path>
        </svg>
    </button>

    <div class="container">
        <div class="hero">
            <h1>ShabdSetu</h1>
            <p>AI-Powered OCR, Proofreading &amp; Translation Platform</p>
        </div>

        <div class="modes-grid" id="modesGrid">
            <div class="mode-card" data-mode="1" data-needs-lang="true" data-accept=".pdf">
                <div class="mode-icon">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z">
                        </path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                </div>
                <h3>OCR</h3>
                <p>Extract text from PDF images with high accuracy</p>
            </div>

            <div class="mode-card" data-mode="2" data-needs-lang="true" data-accept=".pdf">
                <div class="mode-icon">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h3>OCR + Proofread</h3>
                <p>Extract and AI-correct text for perfect results</p>
            </div>

            <div class="mode-card" data-mode="3" data-needs-lang="true" data-accept=".docx">
                <div class="mode-icon">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                        </path>
                    </svg>
                </div>
                <h3>Proofread</h3>
                <p>AI-powered correction of existing documents</p>
            </div>

            <div class="mode-card" data-mode="4" data-needs-translate="true" data-accept=".pdf">
                <div class="mode-icon">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129">
                        </path>
                    </svg>
                </div>
                <h3>OCR + Translate</h3>
                <p>Extract and translate to your target language</p>
            </div>

            <div class="mode-card" data-mode="5" data-needs-translate="true" data-accept=".docx">
                <div class="mode-icon">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                    </svg>
                </div>
                <h3>Translate</h3>
                <p>Professional document translation services</p>
            </div>
        </div>

        <!-- Trial Status Banner -->
        <div class="trial-status-banner" id="trialStatusBanner">
            <div class="trial-status-header">
                <div class="trial-status-title">Free Trial Status</div>
                <div class="trial-status-value" id="trialStatusValue">0 / 3 pages</div>
            </div>
            <div class="trial-progress-bar">
                <div class="trial-progress-fill" id="trialProgressFill" style="width: 100%"></div>
            </div>
            <div class="trial-status-info" id="trialStatusInfo">
                You have full trial access for this tool
            </div>
        </div>

        <div class="processing-panel" id="processingPanel">
            <h2>Configure Processing</h2>

            <div class="form-group">
                <label>Upload Document</label>
                <div class="file-upload" id="fileUpload">
                    <div class="file-upload-icon">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12">
                            </path>
                        </svg>
                    </div>
                    <h3>Choose a file or drag it here</h3>
                    <p id="fileTypeText">PDF files only (Max 50MB)</p>
                    <input type="file" id="fileInput" accept=".pdf">
                </div>

                <div class="file-preview" id="filePreview">
                    <div class="file-thumbnail" id="fileThumbnail">
                        <div class="file-thumbnail-icon">
                            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                </path>
                            </svg>
                        </div>
                    </div>
                    <div class="file-details">
                        <div class="file-name" id="fileName"></div>
                        <div class="file-info">
                            <div class="file-info-item">
                                <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z">
                                    </path>
                                </svg>
                                <span id="fileFormat">PDF</span>
                            </div>
                            <div class="file-info-item">
                                <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4">
                                    </path>
                                </svg>
                                <span id="fileSize">0 KB</span>
                            </div>
                            <div class="file-info-item" id="filePagesItem" style="display: none;">
                                <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                    </path>
                                </svg>
                                <span id="filePages">0 pages</span>
                            </div>
                        </div>
                        <button class="file-remove" id="fileRemove">
                            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                                </path>
                            </svg>
                            Remove
                        </button>
                    </div>
                </div>
            </div>

            <div class="form-group" id="languageGroup" style="display: block;">
                <label for="language">Document Language</label>
                <select class="form-control" id="language">
                    <option value="hindi">Hindi (हिंदी)</option>
                    <option value="gujarati">Gujarati (ગુજરાતી)</option>
                    <option value="english">English</option>
                    <option value="Others">Others</option>
                </select>
            </div>

            <div id="translationGroup" style="display: none;">
                <div class="form-group">
                    <label for="sourceLang">Source Language</label>
                    <select class="form-control" id="sourceLang">
                        <option value="hindi">Hindi (हिंदी)</option>
                        <option value="gujarati">Gujarati (ગુજરાતી)</option>
                        <option value="english">English</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="targetLang">Target Language</label>
                    <select class="form-control" id="targetLang">
                        <option value="english">English</option>
                        <option value="hindi">Hindi (हिंदी)</option>
                        <option value="gujarati">Gujarati (ગુજરાતી)</option>
                    </select>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" id="processBtn" disabled="">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    Start Processing
                </button>
                <button class="btn btn-secondary" id="backBtn">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Back to Modes
                </button>
            </div>

            <div class="progress-container" id="progressContainer">
                <h3>Processing Your Document...</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div class="progress-text" id="progressText">Initializing... 0%</div>
            </div>

            <div class="success-message" id="successMessage">
                <h4>
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Processing Complete!
                </h4>
                <p>Your document has been processed successfully.</p>
                <div>
                    <button class="btn btn-success" id="downloadBtn">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                        </svg>
                        Download Document
                    </button>
                    <button class="btn btn-primary" id="newDocBtn">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                            </path>
                        </svg>
                        Process Another Document
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Product</h4>
                    <ul>
                        <li><a href="features">Features</a></li>
                        <li><a href="pricing">Pricing</a></li>
                        <li><a href="Tool">Tool</a></li>
                        <li><a href="contactus">Contact us</a></li>
                        <li><a href="terms&condtions">Terms & Conditions</a></li>
                    </ul>
                </div>

                <div class="footer-bottom">
                    <p>© 2026 ShabdSetu. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Error Modal -->
    <div class="error-modal" id="errorModal">
        <div class="error-modal-content">
            <div class="error-modal-header">
                <div class="error-modal-icon">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                </div>
                <h3 class="error-modal-title">Trial Limit Exceeded</h3>
            </div>
            <p class="error-modal-message" id="errorModalMessage"></p>
            <div class="error-modal-details" id="errorModalDetails" style="display: none;"></div>
            <div class="error-modal-actions">
                <button class="btn btn-primary" id="errorModalClose">Got It</button>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="error-modal" id="paymentModal">
        <div class="error-modal-content" style="border-color: var(--accent-green);">
            <div class="error-modal-header">
                <div class="error-modal-icon" style="background: var(--accent-green);">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                </div>
                <h3 class="error-modal-title">Premium Processing</h3>
            </div>
            <p class="error-modal-message">
                Your document exceeds the free trial limits. You can process it by paying a small fee.
            </p>
            <div class="error-modal-details" id="paymentDetails">
                <!-- Populated by JS -->
            </div>
            <div class="error-modal-actions">
                <button class="btn btn-secondary" id="paymentModalClose">Cancel</button>
                <button class="btn btn-success" id="payNowBtn">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    Pay & Process
                </button>
            </div>
        </div>
    </div>

    <!-- Hidden data for JS -->
    <div id="trial-info-data" data-trial-info="{{ trial_info | tojson }}" style="display: none;"></div>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="static/trial-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js'; 
    </script>

    <script>
        let selectedMode = null;
        let uploadedFile = null;
        let jobId = null;
        let currentAcceptTypes = '.pdf,.docx';
        let currentTrialInfo = null;

        // Trial info passed from backend
        const trialInfoElement = document.getElementById('trial-info-data');
        const trialInfoAllModes = JSON.parse('{{ trial_info | tojson | safe | default ("{}") }}');
        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const htmlElement = document.documentElement;
        htmlElement.setAttribute('data-theme', 'light');

        themeToggle.addEventListener('click', () => {
            const currentTheme = htmlElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            htmlElement.setAttribute('data-theme', newTheme);
        });

        // Mobile Menu Toggle
        const mobileToggle = document.getElementById('mobileToggle');
        const navMenu = document.getElementById('navMenu');

        mobileToggle.addEventListener('click', () => {
            navMenu.classList.toggle('active');
        });

        // Close mobile menu when clicking a link
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', () => {
                navMenu.classList.remove('active');
            });
        });

        // Trial status management
        function updateTrialStatus(trialInfo) {
            if (!trialInfo) return;

            currentTrialInfo = trialInfo;
            const banner = document.getElementById('trialStatusBanner');
            const value = document.getElementById('trialStatusValue');
            const fill = document.getElementById('trialProgressFill');
            const info = document.getElementById('trialStatusInfo');

            // Update values
            value.textContent = `${trialInfo.pages_used} / ${trialInfo.limit} pages used`;
            const percentage = (trialInfo.pages_remaining / trialInfo.limit) * 100;
            fill.style.width = percentage + '%';

            // Update banner state
            banner.classList.remove('warning', 'exhausted');
            banner.classList.add('active');

            if (trialInfo.pages_remaining <= 0) {
                banner.classList.add('exhausted');
                info.textContent = '⚠️ Trial exhausted for this tool. Please upgrade to continue.';
            } else if (trialInfo.pages_remaining <= 1) {
                banner.classList.add('warning');
                info.textContent = `⚠️ Only ${trialInfo.pages_remaining.toFixed(1)} page(s) remaining!`;
            } else {
                info.textContent = `${trialInfo.pages_remaining.toFixed(1)} page(s) remaining for this tool.`;
            }
        }

        // Error Modal functions
        function showErrorModal(errorData) {
            const modal = document.getElementById('errorModal');
            const message = document.getElementById('errorModalMessage');
            const details = document.getElementById('errorModalDetails');

            message.textContent = errorData.message || 'An error occurred.';

            // Show details if available
            if (errorData.pages_used !== undefined) {
                let detailsHTML = '';
                detailsHTML += `<div class="error-modal-detail-item">
            <span class="error-modal-detail-label">Trial Used:</span>
            <span class="error-modal-detail-value">${errorData.pages_used} / ${errorData.limit} pages</span>
        </div>`;

                detailsHTML += `<div class="error-modal-detail-item">
            <span class="error-modal-detail-label">Remaining:</span>
            <span class="error-modal-detail-value">${errorData.pages_remaining.toFixed(2)} pages</span>
        </div>`;

                if (errorData.document_pages) {
                    detailsHTML += `<div class="error-modal-detail-item">
                <span class="error-modal-detail-label">Your Document:</span>
                <span class="error-modal-detail-value">${errorData.document_pages} pages (PDF)</span>
            </div>`;
                }

                if (errorData.document_chars) {
                    detailsHTML += `<div class="error-modal-detail-item">
                <span class="error-modal-detail-label">Your Document:</span>
                <span class="error-modal-detail-value">${errorData.document_chars.toLocaleString()} characters</span>
            </div>`;
                    detailsHTML += `<div class="error-modal-detail-item">
                <span class="error-modal-detail-label">Equivalent Pages:</span>
                <span class="error-modal-detail-value">≈${errorData.page_usage.toFixed(2)} pages</span>
            </div>`;
                }

                details.innerHTML = detailsHTML;
                details.style.display = 'block';
            } else {
                details.style.display = 'none';
            }

            modal.classList.add('active');
        }

        function hideErrorModal() {
            document.getElementById('errorModal').classList.remove('active');
        }

        document.getElementById('errorModalClose').addEventListener('click', hideErrorModal);

        // Close modal when clicking outside
        document.getElementById('errorModal').addEventListener('click', function (e) {
            if (e.target === this) {
                hideErrorModal();
            }
        });

        // Payment Modal functions
        let currentPaymentData = null;

        function showPaymentModal(data) {
            const modal = document.getElementById('paymentModal');
            const details = document.getElementById('paymentDetails');
            currentPaymentData = data;

            let html = '';
            html += `<div class="error-modal-detail-item">
                <span class="error-modal-detail-label">Billable Pages:</span>
                <span class="error-modal-detail-value">${data.billable_pages} pages</span>
            </div>`;

            if (data.word_count) {
                html += `<div class="error-modal-detail-item">
                    <span class="error-modal-detail-label">Word Count:</span>
                    <span class="error-modal-detail-value">${data.word_count.toLocaleString()} words</span>
                </div>`;
            }

            html += `<div class="error-modal-detail-item">
                <span class="error-modal-detail-label">Rate:</span>
                <span class="error-modal-detail-value">₹${(data.estimated_cost / data.billable_pages).toFixed(2)} / page</span>
            </div>`;

            html += `<div class="error-modal-detail-item" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                <span class="error-modal-detail-label" style="font-size: 1.1rem; font-weight: 600;">Total Cost:</span>
                <span class="error-modal-detail-value" style="font-size: 1.25rem; color: var(--accent-green);">₹${data.estimated_cost.toFixed(2)}</span>
            </div>`;

            details.innerHTML = html;
            modal.classList.add('active');
        }

        function hidePaymentModal() {
            document.getElementById('paymentModal').classList.remove('active');
            currentPaymentData = null;
        }

        document.getElementById('paymentModalClose').addEventListener('click', hidePaymentModal);

        document.getElementById('payNowBtn').addEventListener('click', async () => {
            if (!currentPaymentData) return;

            const btn = document.getElementById('payNowBtn');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = 'Creating Order...';

            try {
                // 1. Create Razorpay Order
                const orderResponse = await fetch('/create-payment', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        mode: selectedMode,
                        pages: currentPaymentData.billable_pages
                    })
                });

                const orderData = await orderResponse.json();

                if (!orderData.success) {
                    throw new Error(orderData.error || 'Failed to create order');
                }

                btn.innerHTML = 'Opening Payment Gateway...';

                // 2. Open Razorpay Checkout
                const options = {
                    key: orderData.key_id,
                    amount: orderData.amount_paise,
                    currency: orderData.currency,
                    name: 'ShabdSetu',
                    description: `Process ${orderData.pages} pages - Mode ${selectedMode}`,
                    order_id: orderData.order_id,
                    handler: async function (response) {
                        // Payment successful - verify on backend
                        try {
                            btn.innerHTML = 'Verifying Payment...';

                            // Save billable_pages before hiding modal (which sets currentPaymentData to null)
                            const billablePages = currentPaymentData.billable_pages;
                            hidePaymentModal();

                            const verifyResponse = await fetch('/verify-payment', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    razorpay_order_id: response.razorpay_order_id,
                                    razorpay_payment_id: response.razorpay_payment_id,
                                    razorpay_signature: response.razorpay_signature,
                                    mode: selectedMode,
                                    pages: billablePages,
                                    amount: orderData.amount
                                })
                            });

                            const verifyData = await verifyResponse.json();

                            if (!verifyData.success) {
                                throw new Error(verifyData.error || 'Payment verification failed');
                            }

                            // 3. Process File with Payment ID
                            const formData = new FormData();
                            formData.append('file', uploadedFile);
                            formData.append('mode', selectedMode);
                            formData.append('language', document.getElementById('language').value);
                            formData.append('source_lang', document.getElementById('sourceLang').value);
                            formData.append('target_lang', document.getElementById('targetLang').value);
                            formData.append('payment_id', response.razorpay_payment_id);

                            document.getElementById('progressContainer').classList.add('active');
                            document.getElementById('processBtn').disabled = true;

                            const processResponse = await fetch('/process', {
                                method: 'POST',
                                body: formData
                            });

                            const processData = await processResponse.json();

                            if (processResponse.ok && processData.job_id) {
                                jobId = processData.job_id;
                                pollProgress(jobId);
                            } else {
                                alert('Error processing after payment: ' + (processData.error || 'Unknown error'));
                                resetProgress();
                            }

                        } catch (error) {
                            alert('Error after payment: ' + error.message);
                            resetProgress();
                        } finally {
                            btn.disabled = false;
                            btn.innerHTML = originalText;
                        }
                    },
                    prefill: {
                        email: '{{ session.get("user_email", "") }}'
                    },
                    theme: {
                        color: '#3b82f6'
                    },
                    modal: {
                        ondismiss: function () {
                            // User closed the payment modal
                            btn.disabled = false;
                            btn.innerHTML = originalText;
                            alert('Payment cancelled. Please try again.');
                        }
                    }
                };

                const razorpay = new Razorpay(options);

                razorpay.on('payment.failed', function (response) {
                    // Payment failed
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                    alert('Payment failed: ' + response.error.description);
                });

                razorpay.open();

            } catch (error) {
                alert('Payment initialization failed: ' + error.message);
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        });

        // Close modal when clicking outside
        document.getElementById('paymentModal').addEventListener('click', function (e) {
            if (e.target === this) {
                hidePaymentModal();
            }
        });

        // Mode selection
        document.querySelectorAll('.mode-card').forEach(card => {
            card.addEventListener('click', function () {
                document.querySelectorAll('.mode-card').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                selectedMode = this.dataset.mode;

                // Update trial status for selected mode
                if (trialInfoAllModes[selectedMode]) {
                    updateTrialStatus(trialInfoAllModes[selectedMode]);
                }

                currentAcceptTypes = this.dataset.accept;
                document.getElementById('fileInput').accept = currentAcceptTypes;

                const fileTypeText = document.getElementById('fileTypeText');
                if (currentAcceptTypes === '.pdf') {
                    fileTypeText.textContent = 'PDF files only (Max 50MB)';
                } else {
                    fileTypeText.textContent = 'DOCX files (Max 50MB)';
                }

                document.getElementById('processingPanel').classList.add('active');

                const needsLang = this.dataset.needsLang === 'true';
                const needsTranslate = this.dataset.needsTranslate === 'true';

                document.getElementById('languageGroup').style.display = needsLang ? 'block' : 'none';
                document.getElementById('translationGroup').style.display = needsTranslate ? 'block' : 'none';

                setTimeout(() => {
                    document.getElementById('processingPanel').scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            });
        });

        // File upload
        const fileUpload = document.getElementById('fileUpload');
        const fileInput = document.getElementById('fileInput');
        const filePreview = document.getElementById('filePreview');
        const fileName = document.getElementById('fileName');
        const processBtn = document.getElementById('processBtn');

        fileUpload.addEventListener('click', () => fileInput.click());

        fileInput.addEventListener('change', function (e) {
            if (this.files.length > 0) {
                handleFileSelect(this.files[0]);
            }
        });

        document.getElementById('fileRemove').addEventListener('click', (e) => {
            e.stopPropagation();
            removeFile();
        });

        async function handleFileSelect(file) {
            const fileExt = '.' + file.name.split('.').pop().toLowerCase();
            if (!currentAcceptTypes.includes(fileExt)) {
                alert(`Invalid file type. Please upload ${currentAcceptTypes === '.pdf' ? 'PDF files only' : 'PDF or DOCX files'}.`);
                return;
            }

            if (file.size > 50 * 1024 * 1024) {
                alert('File size exceeds 50MB limit.');
                return;
            }

            uploadedFile = file;

            fileUpload.classList.add('has-file');
            filePreview.classList.add('active');
            processBtn.disabled = false;

            fileName.textContent = file.name;
            document.getElementById('fileFormat').textContent = file.name.split('.').pop().toUpperCase();
            document.getElementById('fileSize').textContent = formatFileSize(file.size);

            if (file.type === 'application/pdf') {
                await generatePDFThumbnail(file);

                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                    const pageCount = pdf.numPages;
                    document.getElementById('filePages').textContent = `${pageCount} page${pageCount !== 1 ? 's' : ''}`;
                    document.getElementById('filePagesItem').style.display = 'flex';
                } catch (error) {
                    console.error('Error getting page count:', error);
                    document.getElementById('filePagesItem').style.display = 'none';
                }
            } else {
                document.getElementById('fileThumbnail').innerHTML = `
            <div class="file-thumbnail-icon">
                <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
            </div>
        `;
                document.getElementById('filePagesItem').style.display = 'none';
            }
        }

        async function generatePDFThumbnail(file) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                const page = await pdf.getPage(1);

                const scale = 0.5;
                const viewport = page.getViewport({ scale });

                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                await page.render({
                    canvasContext: context,
                    viewport: viewport
                }).promise;

                const imgData = canvas.toDataURL();
                document.getElementById('fileThumbnail').innerHTML = `<img src="${imgData}" alt="PDF Preview">`;
            } catch (error) {
                console.error('Error generating thumbnail:', error);
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        function removeFile() {
            uploadedFile = null;
            fileInput.value = '';
            fileUpload.classList.remove('has-file');
            filePreview.classList.remove('active');
            processBtn.disabled = true;
            fileName.textContent = '';
        }

        fileUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUpload.style.borderColor = 'var(--accent-blue)';
        });

        fileUpload.addEventListener('dragleave', () => {
            fileUpload.style.borderColor = 'var(--border)';
        });

        fileUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUpload.style.borderColor = 'var(--border)';

            if (e.dataTransfer.files.length > 0) {
                const file = e.dataTransfer.files[0];
                fileInput.files = e.dataTransfer.files;
                handleFileSelect(file);
            }
        });

        document.getElementById('backBtn').addEventListener('click', () => {
            document.getElementById('processingPanel').classList.remove('active');
            document.getElementById('trialStatusBanner').classList.remove('active');
            document.querySelectorAll('.mode-card').forEach(c => c.classList.remove('active'));
            resetForm();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        document.getElementById('newDocBtn').addEventListener('click', () => {
            resetForm();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        document.getElementById('processBtn').addEventListener('click', async () => {
            if (!uploadedFile || !selectedMode) return;

            const formData = new FormData();
            formData.append('file', uploadedFile);
            formData.append('mode', selectedMode);
            formData.append('language', document.getElementById('language').value);
            formData.append('source_lang', document.getElementById('sourceLang').value);
            formData.append('target_lang', document.getElementById('targetLang').value);

            document.getElementById('progressContainer').classList.add('active');
            processBtn.disabled = true;

            try {
                const response = await fetch('/process', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok && data.job_id) {
                    jobId = data.job_id;
                    // Update trial info if provided
                    if (data.trial_info) {
                        updateTrialStatus(data.trial_info);
                    }
                    pollProgress(jobId);
                } else if (data.error === 'Trial limit exceeded') {
                    // Check if we can offer payment
                    if (data.estimated_cost && data.estimated_cost > 0) {
                        showPaymentModal(data);
                    } else {
                        // Show standard error modal
                        showErrorModal(data);
                    }
                    resetProgress();
                } else {
                    alert('Error: ' + (data.error || data.message || 'Unknown error'));
                    resetProgress();
                }
            } catch (error) {
                alert('Error: ' + error.message);
                resetProgress();
            }
        });

        function pollProgress(jobId) {
            const interval = setInterval(async () => {
                try {
                    const response = await fetch(`/progress/${jobId}`);
                    const data = await response.json();

                    const progressFill = document.getElementById('progressFill');
                    progressFill.style.width = data.percentage + '%';

                    if (data.percentage === 100) {
                        progressFill.classList.add('success');
                    }

                    document.getElementById('progressText').textContent = `${data.status} ${data.percentage}%`;

                    if (data.percentage === 100 && data.output_file) {
                        clearInterval(interval);
                        showSuccess(data.output_file);
                    }

                    if (data.error) {
                        clearInterval(interval);
                        alert('Processing failed: ' + data.status);
                        resetProgress();
                    }
                } catch (error) {
                    clearInterval(interval);
                    alert('Error checking progress: ' + error.message);
                    resetProgress();
                }
            }, 1000);
        }

        function showSuccess(outputFile) {
            document.getElementById('successMessage').classList.add('active');
            document.getElementById('downloadBtn').onclick = () => {
                window.location.href = `/download/${outputFile}`;
            };
        }

        function resetForm() {
            removeFile();
            selectedMode = null;
            jobId = null;
            document.getElementById('processingPanel').classList.remove('active');
            document.querySelectorAll('.mode-card').forEach(c => c.classList.remove('active'));
            resetProgress();
        }

        function resetProgress() {
            document.getElementById('progressContainer').classList.remove('active');
            document.getElementById('successMessage').classList.remove('active');
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = '0%';
            progressFill.classList.remove('success');
            document.getElementById('progressText').textContent = 'Initializing... 0%';
            processBtn.disabled = uploadedFile ? false : true;
        } 
    </script>
</body>

</html>

